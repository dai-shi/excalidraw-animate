(this["webpackJsonpexcalidraw-animate"]=this["webpackJsonpexcalidraw-animate"]||[]).push([[0],{20:function(t,e,n){},21:function(t,e,n){},45:function(t,e,n){},46:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n.n(r),c=n(12),i=n.n(c),o=(n(20),n(21),n(0)),u=n.n(o),s=n(3),l=n(4),d=n(6),f=n(7),p=n(5),b="excalidrawlib",h=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("text"in Blob)){t.next=6;break}return t.next=3,e.text();case 3:n=t.sent,t.next=9;break;case 6:return t.next=8,new Promise((function(t){var n=new FileReader;n.readAsText(e,"utf8"),n.onloadend=function(){n.readyState===FileReader.DONE&&t(n.result)}}));case 8:n=t.sent;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:if(n=t.sent,(r=JSON.parse(n)).type===b){t.next=6;break}throw new Error("alerts.couldNotLoadInvalidFile");case 6:return t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),v="excalidraw",g=function(t){return(null===t||void 0===t?void 0:t.type)===v&&(!t.elements||Array.isArray(t.elements)&&(!t.appState||"object"===typeof t.appState))},w=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("text"in Blob)){t.next=6;break}return t.next=3,e.text();case 3:n=t.sent,t.next=9;break;case 6:return t.next=8,new Promise((function(t){var n=new FileReader;n.readAsText(e,"utf8"),n.onloadend=function(){n.readyState===FileReader.DONE&&t(n.result)}}));case 8:n=t.sent;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=Object(s.a)(u.a.mark((function t(e,n){var r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w(e);case 2:if(r=t.sent,t.prev=3,a=JSON.parse(r),g(a)){t.next=7;break}throw new Error("alerts.couldNotLoadInvalidFile");case 7:return c=Object(p.restore)({elements:a.elements||[]},n),t.abrupt("return",c);case 11:throw t.prev=11,t.t0=t.catch(3),console.error(t.t0.message),new Error("alerts.couldNotLoadInvalidFile");case 15:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e,n){return t.apply(this,arguments)}}(),j=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({description:"Excalidraw files"});case 2:return n=t.sent,t.abrupt("return",x(n,e));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=(n(45),n(46),n(1)),S=function(t){var e=t.link,n=t.size,r=t.fill,a=t.color;return Object(O.jsx)("a",{href:e,className:"GitHubCorner-container","aria-label":"View source on GitHub",target:"_blank",rel:"noopener noreferrer",children:Object(O.jsxs)("svg",{width:n||80,height:n||80,viewBox:"0 0 250 250",style:{fill:r||"#151513",color:a||"#fff",position:"absolute",top:0,border:0,right:0},"aria-hidden":"true",children:[Object(O.jsx)("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),Object(O.jsx)("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"GitHubCorner-octo-arm"}),Object(O.jsx)("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"GitHubCorner-octo-body"})]})})},y=n(13),A=n(15);function C(t){var e=t.simulatePressure?t.points:t.points.length?t.points.map((function(e,n){var r=Object(l.a)(e,2);return[r[0],r[1],t.pressures[n]]})):[[0,0,0]],n={simulatePressure:t.simulatePressure,size:6*t.strokeWidth,thinning:.5,smoothing:.5,streamline:.5,easing:function(t){return t*(2-t)},last:!0},r=Object(A.a)(e,n),a=[],c=Object(l.a)(r,2),i=c[0],o=c[1];a.push("M",i[0],i[1],"Q");for(var u=0;u<r.length;u++)a.push(i[0],i[1],(i[0]+o[0])/2,(i[1]+o[1])/2),i=o,o=r[u];return o=r[0],a.push(i[0],i[1],(i[0]+o[0])/2,(i[1]+o[1])/2),a.push("Z"),a.join(" ")}var N="http://www.w3.org/2000/svg",k=function(t,e,n,r,a){e.setAttribute("opacity","0");var c=t.ownerDocument.createElementNS(N,"animate");c.setAttribute("attributeName","opacity"),c.setAttribute("from","1"),c.setAttribute("to","1"),c.setAttribute("begin","".concat(n,"ms")),c.setAttribute("dur","".concat(r,"ms")),a&&c.setAttribute("fill","freeze"),e.appendChild(c)},E=function(t,e,n,r,a){var c,i=function(){var t=window.location.hash.slice(1),e=new URLSearchParams(t),n=e.get("pointerImg"),r=e.get("pointerWidth"),a=e.get("pointerHeight");return n?{img:n,width:r,height:a}:null}();if(i){var o=t.ownerDocument.createElementNS(N,"image");o.setAttribute("href",i.img),i.width&&o.setAttribute("width",i.width),i.height&&o.setAttribute("height",i.height),k(t,o,r,a);var u=t.ownerDocument.createElementNS(N,"animateMotion");u.setAttribute("path",function(t){var e=t.match(/(M[^C]*C[^M]*)/g);if(!e)return t;if(e.length<=2)return e[e.length-1];var n=e.reduce((function(t,e,n){var r=e.match(/M([\d.-]+) ([\d.-]+) C([\d.-]+) ([\d.-]+)/)||[],a=Object(l.a)(r,5),c=a[1],i=a[2],o=a[3],u=a[4],s=Math.hypot(Number(o)-Number(c),Number(u)-Number(i));return s>t[1]?[n,s]:t}),[0,0]);return e[Object(l.a)(n,1)[0]]}(n)),u.setAttribute("begin","".concat(r,"ms")),u.setAttribute("dur","".concat(a,"ms")),o.appendChild(u),null===(c=e.parentNode)||void 0===c||c.appendChild(o)}},M=function(t,e,n,r){for(var a,c,i=e.getAttribute("d")||"",o=(null===(a=i.match(/M/g))||void 0===a?void 0:a.length)||0,u=((null===(c=i.match(/C/g))||void 0===c?void 0:c.length)||0)/o,s=i,d=function(a){var c=i.replace(new RegExp(["M(\\S+) (\\S+)","((?: C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+){","".concat(a),"})","(?: C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+){1,}"].join(""),"g"),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[3]?e[3].match(/.* (\S+) (\S+)$/).slice(1,3):[e[1],e[2]],c=Object(l.a)(r,2),i=c[0],o=c[1];return"M".concat(e[1]," ").concat(e[2]).concat(e[3])+" C".concat(i," ").concat(o,", ").concat(i," ").concat(o,", ").concat(i," ").concat(o).repeat(u-a)}));0===a&&e.setAttribute("d",c);var o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","d"),o.setAttribute("from",c),o.setAttribute("to",s),o.setAttribute("begin","".concat(n+a*(r/u),"ms")),o.setAttribute("dur","".concat(r/u,"ms")),o.setAttribute("fill","freeze"),e.appendChild(o),s=c},f=u-1;f>=0;f-=1)d(f);E(t,e,i,n,r),k(t,e,n,r,!0)},L=function(t,e,n,r){var a=e.getAttribute("d")||"";if(a.includes("C"))M(t,e,n,r);else{var c=a.replace(new RegExp(["M(\\S+) (\\S+)","((?: L\\S+ \\S+){1,})"].join("")),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"M".concat(e[1]," ").concat(e[2])+e[3].replace(/L\S+ \S+/g,"L".concat(e[1]," ").concat(e[2]))}));e.setAttribute("d",c);var i=t.ownerDocument.createElementNS(N,"animate");i.setAttribute("attributeName","d"),i.setAttribute("from",c),i.setAttribute("to",a),i.setAttribute("begin","".concat(n,"ms")),i.setAttribute("dur","".concat(r,"ms")),i.setAttribute("fill","freeze"),e.appendChild(i)}},T=function(t,e,n,r){var a,c,i,o,u=e.getAttribute("d")||"",s=(null===(a=u.match(/M/g))||void 0===a?void 0:a.length)||0,f=(null===(c=u.match(/C/g))||void 0===c?void 0:c.length)||0;s===f+1&&(s=(null===(i=(u=u.replace(/^M\S+ \S+ M/,"M")).match(/M/g))||void 0===i?void 0:i.length)||0,f=(null===(o=u.match(/C/g))||void 0===o?void 0:o.length)||0);if(s!==f)throw new Error("unexpected m/c counts");for(var p=e.getAttribute("stroke-dasharray")?1:Math.min(2,s),b=s/p,h=u,m=function(a){var c=u.replace(new RegExp(["((?:","M(\\S+) (\\S+) C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(p),"){","".concat(a),"})","M(\\S+) (\\S+) C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(p),".*"].join("")),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"".concat(e[1])+Object(d.a)(Array(p).keys()).map((function(t){var n=e.slice(2+2*p+2*t),r=Object(l.a)(n,2),a=r[0],c=r[1];return"M".concat(a," ").concat(c," C").concat(a," ").concat(c,", ").concat(a," ").concat(c,", ").concat(a," ").concat(c," ")})).join("").repeat(b-a)}));0===a&&e.setAttribute("d",c);var i=t.ownerDocument.createElementNS(N,"animate");i.setAttribute("attributeName","d"),i.setAttribute("from",c),i.setAttribute("to",h),i.setAttribute("begin","".concat(n+a*(r/b),"ms")),i.setAttribute("dur","".concat(r/b,"ms")),i.setAttribute("fill","freeze"),e.appendChild(i),h=c,E(t,e,u.replace(new RegExp(["(?:","M\\S+ \\S+ C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(p),"){","".concat(a),"}","(M\\S+ \\S+ C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+) ?".repeat(p),".*"].join("")),"$1"),n+a*(r/b),r/b)},v=b-1;v>=0;v-=1)m(v);k(t,e,n,r,!0)},D=0,R=function(t,e,n,r,a,c){var i=t.ownerDocument.createElementNS(N,"path"),o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","d"),o.setAttribute("from",n),o.setAttribute("to",r),o.setAttribute("begin","".concat(a,"ms")),o.setAttribute("dur","".concat(c,"ms")),i.appendChild(o),e.appendChild(i)},P=function(t,e,n,r,a){var c=e.childNodes,i=c.length;c.forEach((function(e){!function(t,e,n,r,a){var c;if("start"!==(n.getAttribute("text-anchor")||"start")){var i=n.getAttribute("opacity")||"1.0",o=t.ownerDocument.createElementNS(N,"animate");return o.setAttribute("attributeName","opacity"),o.setAttribute("from","0.0"),o.setAttribute("to",i),o.setAttribute("begin","".concat(r,"ms")),o.setAttribute("dur","".concat(a,"ms")),o.setAttribute("fill","freeze"),n.appendChild(o),void n.setAttribute("opacity","0.0")}var u=Number(n.getAttribute("x")||0),s=Number(n.getAttribute("y")||0);D+=1;var l=t.ownerDocument.createElementNS(N,"path");l.setAttribute("id","pathForText"+D);var d=t.ownerDocument.createElementNS(N,"animate");d.setAttribute("attributeName","d"),d.setAttribute("from","m".concat(u," ").concat(s," h0")),d.setAttribute("to","m".concat(u," ").concat(s," h").concat(e)),d.setAttribute("begin","".concat(r,"ms")),d.setAttribute("dur","".concat(a,"ms")),d.setAttribute("fill","freeze"),l.appendChild(d);var f=t.ownerDocument.createElementNS(N,"textPath");f.setAttribute("href","#pathForText"+D),f.textContent=n.textContent,n.textContent=" ",null===(c=function(t,e){for(var n=t.childNodes,r=0;r<n.length;++r)if(n[r].tagName===e)return n[r];return null}(t,"defs"))||void 0===c||c.appendChild(l),n.appendChild(f),E(t,n,"m".concat(u," ").concat(s," h").concat(e),r,a)}(t,n,e,r,a/i),r+=a/i}))},z=function(t,e,n,r,a){var c=n.type,i=n.strokeSharpness,o=n.width;"line"===c?function(t,e,n,r,a){var c="sharp"!==n?M:T,i=e.childNodes;i[0].getAttribute("fill-rule")?(c(t,i[0].childNodes[1],r,.75*a),r+=.75*a,L(t,i[0].childNodes[0],r,.25*a)):c(t,i[0].childNodes[0],r,a)}(t,e,i,r,a):"arrow"===c?function(t,e,n,r,a){var c="sharp"!==n?M:T,i=e.childNodes.length;c(t,e.childNodes[0].childNodes[0],r,a/(i+2)*3),r+=a/(i+2)*3;for(var o=1;o<i;o+=1)for(var u=e.childNodes[o].childNodes.length,s=0;s<u;s+=1)M(t,e.childNodes[o].childNodes[s],r,a/(i+2)/u),r+=a/(i+2)/u}(t,e,i,r,a):"rectangle"===c||"diamond"===c?function(t,e,n,r){e.childNodes[1]?(T(t,e.childNodes[1],n,.75*r),n+=.75*r,L(t,e.childNodes[0],n,.25*r)):T(t,e.childNodes[0],n,r)}(t,e,r,a):"ellipse"===c?function(t,e,n,r){e.childNodes[1]?(M(t,e.childNodes[1],n,.75*r),n+=.75*r,L(t,e.childNodes[0],n,.25*r)):M(t,e.childNodes[0],n,r)}(t,e,r,a):"text"===c?P(t,e,o,r,a):"freedraw"===n.type&&function(t,e,n,r,a){var c=e.childNodes[0];c.setAttribute("opacity","0");var i=t.ownerDocument.createElementNS(N,"animate");i.setAttribute("attributeName","opacity"),i.setAttribute("from","0"),i.setAttribute("to","1"),i.setAttribute("calcMode","discrete"),i.setAttribute("begin","".concat(r+a-1,"ms")),i.setAttribute("dur","".concat(1,"ms")),i.setAttribute("fill","freeze"),c.appendChild(i),E(t,c,n.points.reduce((function(t,e){var n=Object(l.a)(e,2),r=n[0],a=n[1];return t?t+" T ".concat(r," ").concat(a):"M ".concat(r," ").concat(a)}),""),r,a);for(var o=n.points.length,u=c.getAttribute("d"),s=o-1;s>=0;s-=1){var d=s>0?C(Object(y.a)(Object(y.a)({},n),{},{points:n.points.slice(0,s)})):"M 0 0";R(t,e,d,u,r+s*(a/o),a/o),u=d}}(t,e,n,r,a)},B=function(t,e){var n=t.id.match(new RegExp("".concat(e,":(-?\\d+)")));return n&&Number(n[1])||0},F=function(t,e,n){var r,a=function(t,e){var n={},r=0;return t.childNodes.forEach((function(t){if("g"===t.tagName){var a=e[r].groupIds;if(a.length>=1){var c=a[0];n[c]=n[c]||[],n[c].push([t,r])}r+=1}})),n}(t,e),c=new Map,i=null!==n&&void 0!==n?n:1e3,o=(r=t.childNodes,Object(d.a)(r).filter((function(t){return"g"===t.tagName})));if(o.length!==e.length)throw new Error("element length mismatch");var u=new Map(o.map((function(t,n){return[t,e[n]]})));return function(t,e){return Object(d.a)(t).sort((function(n,r){var a=t.indexOf(n),c=t.indexOf(r);return B(e[a],"animateOrder")-B(e[c],"animateOrder")}))}(o,e).forEach((function(n){var r=u.get(n),o=r.groupIds;if(!c.has(n))if(o.length>=1){var s=o[0],d=a[s],f=B(r,"animateDuration")||5e3/(d.length+1);z(t,n,r,i,f),i+=f,c.set(n,!0),d.forEach((function(n){var r=Object(l.a)(n,2),a=r[0],o=r[1],u=B(e[o],"animateDuration")||5e3/(d.length+1);c.has(a)||(z(t,a,e[o],i,u),i+=u,c.set(a,!0))})),delete a[s]}else{var p=B(r,"animateDuration")||500;z(t,n,r,i,p),i+=p,c.set(n,!0)}})),{finishedMs:i+1e3}},G=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getCurrentTime(),e.setCurrentTime(0),r=(new XMLSerializer).serializeToString(e),e.setCurrentTime(n),t.next=6,Object(f.b)(new Blob([r],{type:"image/svg+xml"}),{fileName:"excalidraw-animate.svg",extensions:[".svg"]});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=function(){var t=Object(s.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.b)(new Blob([e],{type:"video/webm"}),{fileName:"excalidraw-animate.webm",extensions:[".webm"]});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),U=function(t){return new Promise(function(){var e=Object(s.a)(u.a.mark((function e(n,r){var a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:{cursor:"never",displaySurface:"browser"}});case 3:a=e.sent,(c=new MediaRecorder(a)).ondataavailable=function(t){n(t.data)},i=0,t.forEach((function(t){var e=t.svg,n=t.finishedMs;i=Math.max(i,n),e.pauseAnimations(),e.setCurrentTime(0)})),c.start(),t.forEach((function(t){t.svg.unpauseAnimations()})),setTimeout((function(){c.stop(),a.getVideoTracks()[0].stop()}),i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}())},H=function(t,e){return window.crypto.subtle.importKey("jwk",{alg:"A128GCM",ext:!0,k:t,key_ops:["encrypt","decrypt"],kty:"oct"},{name:"AES-GCM",length:128},!1,[e])},W=function(){var t=Object(s.a)(u.a.mark((function t(e,n,r){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H(r,"decrypt");case 2:return a=t.sent,t.abrupt("return",window.crypto.subtle.decrypt({name:"AES-GCM",iv:e},a,n));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),J=function(){var t=Object(s.a)(u.a.mark((function t(e,n){var r,a,c,i,o,s,l,d;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(n?"".concat("https://json.excalidraw.com/api/v2/").concat(e):"".concat("https://json.excalidraw.com/api/v1/").concat(e,".json"));case 3:if((r=t.sent).ok){t.next=7;break}return window.alert("alerts.importBackendFailed"),t.abrupt("return",{});case 7:if(!n){t.next=29;break}return t.next=10,r.arrayBuffer();case 10:return c=t.sent,t.prev=11,o=c.slice(0,12),s=c.slice(12,c.byteLength),t.next=16,W(o,s,n);case 16:i=t.sent,t.next=25;break;case 19:return t.prev=19,t.t0=t.catch(11),l=new Uint8Array(12),t.next=24,W(l,c,n);case 24:i=t.sent;case 25:d=new window.TextDecoder("utf-8").decode(new Uint8Array(i)),a=JSON.parse(d),t.next=32;break;case 29:return t.next=31,r.json();case 31:a=t.sent;case 32:return t.abrupt("return",{elements:a.elements||null,appState:a.appState||null});case 35:return t.prev=35,t.t1=t.catch(0),window.alert("alerts.importBackendFailed"),console.error(t.t1),t.abrupt("return",{});case 40:case"end":return t.stop()}}),t,null,[[0,35],[11,19]])})));return function(e,n){return t.apply(this,arguments)}}(),Z=function(){var t=Object(s.a)(u.a.mark((function t(e,n,r){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e){t.next=9;break}return t.t0=p.restore,t.next=4,J(e,n);case 4:t.t1=t.sent,t.t2=null===r||void 0===r?void 0:r.appState,a=(0,t.t0)(t.t1,t.t2),t.next=10;break;case 9:a=Object(p.restore)(r||null,null);case 10:return t.abrupt("return",{elements:a.elements,appState:a.appState,commitToHistory:!1});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),V=function(t){return t.filter((function(t){return!t.isDeleted}))},$=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:return n=t.sent,t.next=6,n.blob();case 6:return r=t.sent,t.next=9,m(r);case 9:if((a=t.sent)&&a.library){t.next=12;break}throw new Error;case 12:return t.abrupt("return",a.library.map((function(t){return V(Object(p.restoreElements)(t))})));case 15:return t.prev=15,t.t0=t.catch(0),window.alert("Unable to load library"),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}(),_=/#json=([0-9]+),?([a-zA-Z0-9_-]*)|^http.*\.excalidrawlib$/,q=function(t){var e,n=(e=[]).concat.apply(e,Object(d.a)(t.map((function(t){return function(t){var e=[],n=[],r=function t(e){if("animate"===e.tagName){var r=/([0-9.]+)ms/.exec(e.getAttribute("begin")||"");r&&n.push(Number(r[1]))}e.childNodes.forEach((function(e){t(e)}))};return t.childNodes.forEach((function(t){"g"===t.tagName?(r(t),n.length&&(e.push(Math.min.apply(Math,n)),n.splice(0))):"defs"===t.tagName&&t.childNodes.forEach((function(t){r(t),n.length&&(e.push(Math.min.apply(Math,n)),n.splice(0))}))})),e}(t.svg).map((function(t){return Math.floor(100*t)/100}))}))));return Object(d.a)(new Set(n)).sort((function(t,e){return t-e}))},Q=function(t){var e=t.svgList,n=t.loadDataList,a=Object(r.useState)(!1),c=Object(l.a)(a,2),i=c[0],o=c[1],d=Object(r.useState)(!1),b=Object(l.a)(d,2),h=b[0],v=b[1],g=Object(r.useState)(!1),w=Object(l.a)(g,2),x=w[0],y=w[1],A=Object(r.useState)(""),C=Object(l.a)(A,2),N=C[0],k=C[1],E=Object(r.useState)(),M=Object(l.a)(E,2),L=M[0],T=M[1];Object(r.useEffect)((function(){T(void 0)}),[e]),Object(r.useEffect)((function(){e.forEach((function(t){var e=t.svg;h?e.pauseAnimations():e.unpauseAnimations()}))}),[e,h]),Object(r.useEffect)((function(){var t=window.location.hash.slice(1);"no"!==new URLSearchParams(t).get("toolbar")?o(!0):o("never")}),[]);var D=function(){var t=Object(s.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(null);case 2:e=t.sent,n([e]);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=Object(s.a)(u.a.mark((function t(){var e,r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({description:"Excalidraw library files",extensions:[".json",".excalidrawlib"],mimeTypes:["application/json"]});case 2:return e=t.sent,t.next=5,m(e);case 5:if((r=t.sent)&&r.library){t.next=9;break}return window.alert("Unable to load library"),t.abrupt("return");case 9:a=r.library.map((function(t){return V(Object(p.restoreElements)(t))})),n(a.map((function(t){return{elements:t}})));case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=Object(r.useCallback)((function(){e.length&&v((function(t){return!t}))}),[e]),z=Object(r.useRef)(),B=Object(r.useCallback)((function(){if(e.length){var t=q(e),n=1e3*e[0].svg.getCurrentTime(),r=t.find((function(t){return t>=n+100}));r||(r=n+500),clearTimeout(z.current),e.forEach((function(t){t.svg.unpauseAnimations()})),z.current=setTimeout((function(){e.forEach((function(t){var e=t.svg;e.pauseAnimations(),e.setCurrentTime(r/1e3)})),v(!0)}),r-n)}}),[e]),F=Object(r.useCallback)((function(){e.forEach((function(t){t.svg.setCurrentTime(0)}))}),[e]);Object(r.useEffect)((function(){var t=function(t){"p"===t.key.toLowerCase()?P():"s"===t.key.toLowerCase()?B():"r"===t.key.toLowerCase()?F():"q"===t.key.toLowerCase()?o((function(t){return"boolean"===typeof t?!t:t})):o((function(t){return"boolean"===typeof t||t}))};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[P,B,F]);var H=function(){var t=Object(s.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.length){t.next=2;break}return t.abrupt("return");case 2:if(!L){t.next=6;break}return t.next=5,I(L);case 5:return t.abrupt("return");case 6:return y(!0),o(!1),t.prev=8,t.next=11,U(e);case 11:n=t.sent,T(n),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(8),console.log(t.t0);case 18:o(!0),y(!1);case 20:case"end":return t.stop()}}),t,null,[[8,15]])})));return function(){return t.apply(this,arguments)}}();return!0!==i?null:Object(O.jsxs)("div",{className:"Toolbar",children:[Object(O.jsxs)("div",{className:"Toolbar-loader",children:[Object(O.jsx)("button",{type:"button",onClick:D,children:"Load File"}),Object(O.jsx)("span",{children:"OR"}),Object(O.jsx)("button",{type:"button",onClick:R,children:"Load Library"}),Object(O.jsx)("span",{children:"OR"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var e=_.exec(N);e?(e[1]?window.location.hash=e[0]:window.location.hash="library=".concat(e[0]),window.location.reload()):window.alert("Invalid link")},children:[Object(O.jsx)("input",{placeholder:"Enter link...",value:N,onChange:function(t){return k(t.target.value)}}),Object(O.jsx)("button",{type:"submit",disabled:!_.test(N),children:"Animate!"})]})]}),!!e.length&&Object(O.jsxs)("div",{className:"Toolbar-controller",children:[Object(O.jsx)("button",{type:"button",onClick:P,children:h?"Play (P)":"Pause (P)"}),Object(O.jsx)("button",{type:"button",onClick:B,children:"Step (S)"}),Object(O.jsx)("button",{type:"button",onClick:F,children:"Reset (R)"}),Object(O.jsx)("button",{type:"button",onClick:function(){o((function(t){return"boolean"!==typeof t&&t}))},children:"Hide Toolbar (Q)"}),Object(O.jsx)("button",{type:"button",onClick:function(){e.length&&e.forEach((function(t){var e=t.svg;G(e)}))},children:"Export to SVG"}),Object(O.jsx)("button",{type:"button",onClick:H,disabled:x,children:x?"Processing...":L?"Export to WebM":"Prepare WebM"})]}),Object(O.jsx)(S,{link:"https://github.com/dai-shi/excalidraw-animate",size:40})]})},K=(n(48),function(t){var e=t.svgList,n=Object(r.useRef)(null);Object(r.useEffect)((function(){return e.forEach((function(t){var e=t.svg;n.current&&n.current.appendChild(e)})),function(){e.forEach((function(t){t.svg.remove()}))}}),[e]),Object(r.useEffect)((function(){var t=window.location.hash.slice(1);if("no"===new URLSearchParams(t).get("autoplay")&&n.current){var r=n.current,a=function(){e.forEach((function(t){var e=t.svg;e.setCurrentTime(0),e.unpauseAnimations()}))};return r.addEventListener("click",a),function(){r.removeEventListener("click",a)}}}),[e]);var a=Math.ceil(Math.sqrt(e.length)),c="repeat(".concat(a,", ").concat(100/a,"%)");return Object(O.jsx)("div",{className:"Viewer",style:{gridTemplateColumns:c,gridTemplateRows:c},ref:n})}),X=function(){var t=function(){var t=Object(r.useState)(!0),e=Object(l.a)(t,2),n=e[0],a=e[1],c=Object(r.useState)([]),i=Object(l.a)(c,2),o=i[0],d=i[1],f=Object(r.useCallback)((function(t,e){var n,r=t.map((function(t){var r=V(t.elements),a=Object(p.exportToSvg)({elements:r,appState:{exportBackground:!0,viewBackgroundColor:"white",shouldAddWatermark:!1},exportPadding:30}),c=F(a,r,n);return console.log(a),e&&(n=c.finishedMs),{svg:a,finishedMs:c.finishedMs}}));return d(r),r}),[]);return Object(r.useEffect)((function(){Object(s.a)(u.a.mark((function t(){var e,n,r,c,i,o,s,d,p,b,h,m,v,g,w,x,j;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.location.hash.slice(1),n=new URLSearchParams(e),!(r=/([0-9]+),?([a-zA-Z0-9_-]*)/.exec(n.get("json")||""))){t.next=10;break}return c=Object(l.a)(r,3),i=c[1],o=c[2],t.next=7,Z(i,o,null);case 7:s=t.sent,d=f([s]),p=Object(l.a)(d,1),b=p[0],h=b.svg,m=b.finishedMs,"no"===n.get("autoplay")&&h.setCurrentTime(m);case 10:if(!(v=/(.*\.excalidrawlib)/.exec(n.get("library")||""))){t.next=18;break}return g=Object(l.a)(v,2),w=g[1],t.next=15,$(w);case 15:x=t.sent,j=f(x.map((function(t){return{elements:t}})),n.has("sequence")),"no"===n.get("autoplay")&&j.forEach((function(t){var e=t.svg,n=t.finishedMs;e.setCurrentTime(n)}));case 18:a(!1);case 19:case"end":return t.stop()}}),t)})))()}),[f]),{loading:n,loadedSvgList:o,loadDataList:f}}(),e=t.loading,n=t.loadedSvgList,a=t.loadDataList;return e?Object(O.jsx)("div",{children:"Loading..."}):Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(Q,{svgList:n,loadDataList:a}),!!n.length&&Object(O.jsx)(K,{svgList:n})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(X,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[49,1,2]]]);
//# sourceMappingURL=main.a272bc44.chunk.js.map