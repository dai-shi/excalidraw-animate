(this["webpackJsonpexcalidraw-animate"]=this["webpackJsonpexcalidraw-animate"]||[]).push([[0],{20:function(t,e,n){},21:function(t,e,n){},45:function(t,e,n){},46:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n.n(r),c=n(12),i=n.n(c),o=(n(20),n(21),n(0)),u=n.n(o),s=n(3),l=n(4),d=n(6),f=n(7),p=n(5),b="excalidrawlib",h=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("text"in Blob)){t.next=6;break}return t.next=3,e.text();case 3:n=t.sent,t.next=9;break;case 6:return t.next=8,new Promise((function(t){var n=new FileReader;n.readAsText(e,"utf8"),n.onloadend=function(){n.readyState===FileReader.DONE&&t(n.result)}}));case 8:n=t.sent;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:if(n=t.sent,(r=JSON.parse(n)).type===b){t.next=6;break}throw new Error("alerts.couldNotLoadInvalidFile");case 6:return t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),v="excalidraw",g=function(t){return(null===t||void 0===t?void 0:t.type)===v&&(!t.elements||Array.isArray(t.elements)&&(!t.appState||"object"===typeof t.appState))},w=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("text"in Blob)){t.next=6;break}return t.next=3,e.text();case 3:n=t.sent,t.next=9;break;case 6:return t.next=8,new Promise((function(t){var n=new FileReader;n.readAsText(e,"utf8"),n.onloadend=function(){n.readyState===FileReader.DONE&&t(n.result)}}));case 8:n=t.sent;case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=Object(s.a)(u.a.mark((function t(e,n){var r,a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w(e);case 2:if(r=t.sent,t.prev=3,a=JSON.parse(r),g(a)){t.next=7;break}throw new Error("alerts.couldNotLoadInvalidFile");case 7:return c=Object(p.restore)({elements:a.elements||[]},n),t.abrupt("return",c);case 11:throw t.prev=11,t.t0=t.catch(3),console.error(t.t0.message),new Error("alerts.couldNotLoadInvalidFile");case 15:case"end":return t.stop()}}),t,null,[[3,11]])})));return function(e,n){return t.apply(this,arguments)}}(),j=function(){var t=Object(s.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({description:"Excalidraw files"});case 2:return n=t.sent,t.abrupt("return",x(n,e));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=(n(45),n(46),n(1)),S=function(t){var e=t.link,n=t.size,r=t.fill,a=t.color;return Object(O.jsx)("a",{href:e,className:"GitHubCorner-container","aria-label":"View source on GitHub",target:"_blank",rel:"noopener noreferrer",children:Object(O.jsxs)("svg",{width:n||80,height:n||80,viewBox:"0 0 250 250",style:{fill:r||"#151513",color:a||"#fff",position:"absolute",top:0,border:0,right:0},"aria-hidden":"true",children:[Object(O.jsx)("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),Object(O.jsx)("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"GitHubCorner-octo-arm"}),Object(O.jsx)("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"GitHubCorner-octo-body"})]})})},y=n(13),A=n(15);function C(t){var e=t.simulatePressure?t.points:t.points.length?t.points.map((function(e,n){var r=Object(l.a)(e,2);return[r[0],r[1],t.pressures[n]]})):[[0,0,0]],n={simulatePressure:t.simulatePressure,size:6*t.strokeWidth,thinning:.5,smoothing:.5,streamline:.5,easing:function(t){return t*(2-t)},last:!0},r=Object(A.a)(e,n),a=[],c=Object(l.a)(r,2),i=c[0],o=c[1];a.push("M",i[0],i[1],"Q");for(var u=0;u<r.length;u++)a.push(i[0],i[1],(i[0]+o[0])/2,(i[1]+o[1])/2),i=o,o=r[u];return o=r[0],a.push(i[0],i[1],(i[0]+o[0])/2,(i[1]+o[1])/2),a.push("Z"),a.join(" ")}var N="http://www.w3.org/2000/svg",k=function(t,e,n,r,a){e.setAttribute("opacity","0");var c=t.ownerDocument.createElementNS(N,"animate");c.setAttribute("attributeName","opacity"),c.setAttribute("from","1"),c.setAttribute("to","1"),c.setAttribute("begin","".concat(n,"ms")),c.setAttribute("dur","".concat(r,"ms")),a&&c.setAttribute("fill","freeze"),e.appendChild(c)},E=function(t,e,n,r,a,c){var i;if(c.pointerImg){var o=t.ownerDocument.createElementNS(N,"image");o.setAttribute("href",c.pointerImg),c.pointerWidth&&o.setAttribute("width",c.pointerWidth),c.pointerHeight&&o.setAttribute("height",c.pointerHeight),k(t,o,r,a);var u=t.ownerDocument.createElementNS(N,"animateMotion");u.setAttribute("path",function(t){var e=t.match(/(M[^C]*C[^M]*)/g);if(!e)return t;if(e.length<=2)return e[e.length-1];var n=e.reduce((function(t,e,n){var r=e.match(/M([\d.-]+) ([\d.-]+) C([\d.-]+) ([\d.-]+)/)||[],a=Object(l.a)(r,5),c=a[1],i=a[2],o=a[3],u=a[4],s=Math.hypot(Number(o)-Number(c),Number(u)-Number(i));return s>t[1]?[n,s]:t}),[0,0]);return e[Object(l.a)(n,1)[0]]}(n)),u.setAttribute("begin","".concat(r,"ms")),u.setAttribute("dur","".concat(a,"ms")),o.appendChild(u),null===(i=e.parentNode)||void 0===i||i.appendChild(o)}},M=function(t,e,n,r,a){for(var c,i,o=e.getAttribute("d")||"",u=(null===(c=o.match(/M/g))||void 0===c?void 0:c.length)||0,s=((null===(i=o.match(/C/g))||void 0===i?void 0:i.length)||0)/u,d=o,f=function(a){var c=o.replace(new RegExp(["M(\\S+) (\\S+)","((?: C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+){","".concat(a),"})","(?: C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+){1,}"].join(""),"g"),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[3]?e[3].match(/.* (\S+) (\S+)$/).slice(1,3):[e[1],e[2]],c=Object(l.a)(r,2),i=c[0],o=c[1];return"M".concat(e[1]," ").concat(e[2]).concat(e[3])+" C".concat(i," ").concat(o,", ").concat(i," ").concat(o,", ").concat(i," ").concat(o).repeat(s-a)}));0===a&&e.setAttribute("d",c);var i=t.ownerDocument.createElementNS(N,"animate");i.setAttribute("attributeName","d"),i.setAttribute("from",c),i.setAttribute("to",d),i.setAttribute("begin","".concat(n+a*(r/s),"ms")),i.setAttribute("dur","".concat(r/s,"ms")),i.setAttribute("fill","freeze"),e.appendChild(i),d=c},p=s-1;p>=0;p-=1)f(p);E(t,e,o,n,r,a),k(t,e,n,r,!0)},L=function(t,e,n,r,a){var c=e.getAttribute("d")||"";if(c.includes("C"))M(t,e,n,r,a);else{var i=c.replace(new RegExp(["M(\\S+) (\\S+)","((?: L\\S+ \\S+){1,})"].join("")),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"M".concat(e[1]," ").concat(e[2])+e[3].replace(/L\S+ \S+/g,"L".concat(e[1]," ").concat(e[2]))}));e.setAttribute("d",i);var o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","d"),o.setAttribute("from",i),o.setAttribute("to",c),o.setAttribute("begin","".concat(n,"ms")),o.setAttribute("dur","".concat(r,"ms")),o.setAttribute("fill","freeze"),e.appendChild(o)}},T=function(t,e,n,r,a){var c,i,o,u,s=e.getAttribute("d")||"",f=(null===(c=s.match(/M/g))||void 0===c?void 0:c.length)||0,p=(null===(i=s.match(/C/g))||void 0===i?void 0:i.length)||0;f===p+1&&(f=(null===(o=(s=s.replace(/^M\S+ \S+ M/,"M")).match(/M/g))||void 0===o?void 0:o.length)||0,p=(null===(u=s.match(/C/g))||void 0===u?void 0:u.length)||0);if(f!==p)throw new Error("unexpected m/c counts");for(var b=e.getAttribute("stroke-dasharray")?1:Math.min(2,f),h=f/b,m=s,v=function(c){var i=s.replace(new RegExp(["((?:","M(\\S+) (\\S+) C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(b),"){","".concat(c),"})","M(\\S+) (\\S+) C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(b),".*"].join("")),(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"".concat(e[1])+Object(d.a)(Array(b).keys()).map((function(t){var n=e.slice(2+2*b+2*t),r=Object(l.a)(n,2),a=r[0],c=r[1];return"M".concat(a," ").concat(c," C").concat(a," ").concat(c,", ").concat(a," ").concat(c,", ").concat(a," ").concat(c," ")})).join("").repeat(h-c)}));0===c&&e.setAttribute("d",i);var o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","d"),o.setAttribute("from",i),o.setAttribute("to",m),o.setAttribute("begin","".concat(n+c*(r/h),"ms")),o.setAttribute("dur","".concat(r/h,"ms")),o.setAttribute("fill","freeze"),e.appendChild(o),m=i,E(t,e,s.replace(new RegExp(["(?:","M\\S+ \\S+ C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+ ?".repeat(b),"){","".concat(c),"}","(M\\S+ \\S+ C\\S+ \\S+, \\S+ \\S+, \\S+ \\S+) ?".repeat(b),".*"].join("")),"$1"),n+c*(r/h),r/h,a)},g=h-1;g>=0;g-=1)v(g);k(t,e,n,r,!0)},D=0,R=function(t,e,n,r,a,c){var i=t.ownerDocument.createElementNS(N,"path"),o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","d"),o.setAttribute("from",n),o.setAttribute("to",r),o.setAttribute("begin","".concat(a,"ms")),o.setAttribute("dur","".concat(c,"ms")),i.appendChild(o),e.appendChild(i)},P=function(t,e,n,r,a,c){var i=e.childNodes,o=i.length;i.forEach((function(e){!function(t,e,n,r,a,c){var i;if("start"!==(n.getAttribute("text-anchor")||"start")){var o=n.getAttribute("opacity")||"1.0",u=t.ownerDocument.createElementNS(N,"animate");return u.setAttribute("attributeName","opacity"),u.setAttribute("from","0.0"),u.setAttribute("to",o),u.setAttribute("begin","".concat(r,"ms")),u.setAttribute("dur","".concat(a,"ms")),u.setAttribute("fill","freeze"),n.appendChild(u),void n.setAttribute("opacity","0.0")}var s=Number(n.getAttribute("x")||0),l=Number(n.getAttribute("y")||0);D+=1;var d=t.ownerDocument.createElementNS(N,"path");d.setAttribute("id","pathForText"+D);var f=t.ownerDocument.createElementNS(N,"animate");f.setAttribute("attributeName","d"),f.setAttribute("from","m".concat(s," ").concat(l," h0")),f.setAttribute("to","m".concat(s," ").concat(l," h").concat(e)),f.setAttribute("begin","".concat(r,"ms")),f.setAttribute("dur","".concat(a,"ms")),f.setAttribute("fill","freeze"),d.appendChild(f);var p=t.ownerDocument.createElementNS(N,"textPath");p.setAttribute("href","#pathForText"+D),p.textContent=n.textContent,n.textContent=" ",null===(i=function(t,e){for(var n=t.childNodes,r=0;r<n.length;++r)if(n[r].tagName===e)return n[r];return null}(t,"defs"))||void 0===i||i.appendChild(d),n.appendChild(p),E(t,n,"m".concat(s," ").concat(l," h").concat(e),r,a,c)}(t,n,e,r,a/o,c),r+=a/o}))},z=function(t,e,n,r,a,c){var i=n.type,o=n.strokeSharpness,u=n.width;"line"===i?function(t,e,n,r,a,c){var i="sharp"!==n?M:T,o=e.childNodes;o[0].getAttribute("fill-rule")?(i(t,o[0].childNodes[1],r,.75*a,c),r+=.75*a,L(t,o[0].childNodes[0],r,.25*a,c)):i(t,o[0].childNodes[0],r,a,c)}(t,e,o,r,a,c):"arrow"===i?function(t,e,n,r,a,c){var i="sharp"!==n?M:T,o=e.childNodes.length;i(t,e.childNodes[0].childNodes[0],r,a/(o+2)*3,c),r+=a/(o+2)*3;for(var u=1;u<o;u+=1)for(var s=e.childNodes[u].childNodes.length,l=0;l<s;l+=1)M(t,e.childNodes[u].childNodes[l],r,a/(o+2)/s,c),r+=a/(o+2)/s}(t,e,o,r,a,c):"rectangle"===i||"diamond"===i?function(t,e,n,r,a){e.childNodes[1]?(T(t,e.childNodes[1],n,.75*r,a),n+=.75*r,L(t,e.childNodes[0],n,.25*r,a)):T(t,e.childNodes[0],n,r,a)}(t,e,r,a,c):"ellipse"===i?function(t,e,n,r,a){e.childNodes[1]?(M(t,e.childNodes[1],n,.75*r,a),n+=.75*r,L(t,e.childNodes[0],n,.25*r,a)):M(t,e.childNodes[0],n,r,a)}(t,e,r,a,c):"text"===i?P(t,e,u,r,a,c):"freedraw"===n.type&&function(t,e,n,r,a,c){var i=e.childNodes[0];i.setAttribute("opacity","0");var o=t.ownerDocument.createElementNS(N,"animate");o.setAttribute("attributeName","opacity"),o.setAttribute("from","0"),o.setAttribute("to","1"),o.setAttribute("calcMode","discrete"),o.setAttribute("begin","".concat(r+a-1,"ms")),o.setAttribute("dur","".concat(1,"ms")),o.setAttribute("fill","freeze"),i.appendChild(o),E(t,i,n.points.reduce((function(t,e){var n=Object(l.a)(e,2),r=n[0],a=n[1];return t?t+" T ".concat(r," ").concat(a):"M ".concat(r," ").concat(a)}),""),r,a,c);for(var u=n.points.length,s=i.getAttribute("d"),d=u-1;d>=0;d-=1){var f=d>0?C(Object(y.a)(Object(y.a)({},n),{},{points:n.points.slice(0,d)})):"M 0 0";R(t,e,f,s,r+d*(a/u),a/u),s=f}}(t,e,n,r,a,c)},F=function(t,e){var n={},r=0;return t.childNodes.forEach((function(t){if("g"===t.tagName){var a=e[r].groupIds;if(a.length>=1){var c=a[0];n[c]=n[c]||[],n[c].push([t,r])}r+=1}})),n},B=function(t){return Object(d.a)(t).filter((function(t){return"g"===t.tagName}))},I=function(t,e){var n=t.id.match(new RegExp("".concat(e,":(-?\\d+)")));return n&&Number(n[1])||0},H=function(t,e){return Object(d.a)(t).sort((function(n,r){var a=t.indexOf(n),c=t.indexOf(r);return I(e[a],"animateOrder")-I(e[c],"animateOrder")}))},G=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getCurrentTime(),e.setCurrentTime(0),r=(new XMLSerializer).serializeToString(e),e.setCurrentTime(n),t.next=6,Object(f.b)(new Blob([r],{type:"image/svg+xml"}),{fileName:"excalidraw-animate.svg",extensions:[".svg"]});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),U=function(){var t=Object(s.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.b)(new Blob([e],{type:"video/webm"}),{fileName:"excalidraw-animate.webm",extensions:[".webm"]});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),W=function(t){return new Promise(function(){var e=Object(s.a)(u.a.mark((function e(n,r){var a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:{cursor:"never",displaySurface:"browser"}});case 3:a=e.sent,(c=new MediaRecorder(a)).ondataavailable=function(t){n(t.data)},i=0,t.forEach((function(t){var e=t.svg,n=t.finishedMs;i=Math.max(i,n),e.pauseAnimations(),e.setCurrentTime(0)})),c.start(),t.forEach((function(t){t.svg.unpauseAnimations()})),setTimeout((function(){c.stop(),a.getVideoTracks()[0].stop()}),i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}())},J=function(t,e){return window.crypto.subtle.importKey("jwk",{alg:"A128GCM",ext:!0,k:t,key_ops:["encrypt","decrypt"],kty:"oct"},{name:"AES-GCM",length:128},!1,[e])},Z=function(){var t=Object(s.a)(u.a.mark((function t(e,n,r){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J(r,"decrypt");case 2:return a=t.sent,t.abrupt("return",window.crypto.subtle.decrypt({name:"AES-GCM",iv:e},a,n));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),V=function(){var t=Object(s.a)(u.a.mark((function t(e,n){var r,a,c,i,o,s,l,d;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(n?"".concat("https://json.excalidraw.com/api/v2/").concat(e):"".concat("https://json.excalidraw.com/api/v1/").concat(e,".json"));case 3:if((r=t.sent).ok){t.next=7;break}return window.alert("alerts.importBackendFailed"),t.abrupt("return",{});case 7:if(!n){t.next=29;break}return t.next=10,r.arrayBuffer();case 10:return c=t.sent,t.prev=11,o=c.slice(0,12),s=c.slice(12,c.byteLength),t.next=16,Z(o,s,n);case 16:i=t.sent,t.next=25;break;case 19:return t.prev=19,t.t0=t.catch(11),l=new Uint8Array(12),t.next=24,Z(l,c,n);case 24:i=t.sent;case 25:d=new window.TextDecoder("utf-8").decode(new Uint8Array(i)),a=JSON.parse(d),t.next=32;break;case 29:return t.next=31,r.json();case 31:a=t.sent;case 32:return t.abrupt("return",{elements:a.elements||null,appState:a.appState||null});case 35:return t.prev=35,t.t1=t.catch(0),window.alert("alerts.importBackendFailed"),console.error(t.t1),t.abrupt("return",{});case 40:case"end":return t.stop()}}),t,null,[[0,35],[11,19]])})));return function(e,n){return t.apply(this,arguments)}}(),_=function(){var t=Object(s.a)(u.a.mark((function t(e,n,r){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e){t.next=9;break}return t.t0=p.restore,t.next=4,V(e,n);case 4:t.t1=t.sent,t.t2=null===r||void 0===r?void 0:r.appState,a=(0,t.t0)(t.t1,t.t2),t.next=10;break;case 9:a=Object(p.restore)(r||null,null);case 10:return t.abrupt("return",{elements:a.elements,appState:a.appState,commitToHistory:!1});case 11:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),q=function(t){return t.filter((function(t){return!t.isDeleted}))},$=function(){var t=Object(s.a)(u.a.mark((function t(e){var n,r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:return n=t.sent,t.next=6,n.blob();case 6:return r=t.sent,t.next=9,m(r);case 9:if((a=t.sent)&&a.library){t.next=12;break}throw new Error;case 12:return t.abrupt("return",a.library.map((function(t){return q(Object(p.restoreElements)(t))})));case 15:return t.prev=15,t.t0=t.catch(0),window.alert("Unable to load library"),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}(),Q=function(){var t=Object(r.useState)(!0),e=Object(l.a)(t,2),n=e[0],a=e[1],c=Object(r.useState)([]),i=Object(l.a)(c,2),o=i[0],d=i[1],f=Object(r.useCallback)((function(t,e){var n=window.location.hash.slice(1),r=new URLSearchParams(n),a={startMs:void 0,pointerImg:r.get("pointerImg")||void 0,pointerWidth:r.get("pointerWidth")||void 0,pointerHeight:r.get("pointerHeight")||void 0},c=t.map((function(t){var n=q(t.elements),r=Object(p.exportToSvg)({elements:n,appState:{exportBackground:!0,viewBackgroundColor:"white",shouldAddWatermark:!1},exportPadding:30}),c=function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=F(t,e),c=new Map,i=null!==(n=r.startMs)&&void 0!==n?n:1e3,o=5e3,u=500,s=B(t.childNodes);if(s.length!==e.length)throw new Error("element length mismatch");var d=new Map(s.map((function(t,n){return[t,e[n]]})));return H(s,e).forEach((function(n){var s=d.get(n),f=s.groupIds;if(!c.has(n))if(f.length>=1){var p=f[0],b=a[p],h=I(s,"animateDuration")||o/(b.length+1);z(t,n,s,i,h,r),i+=h,c.set(n,!0),b.forEach((function(n){var a=Object(l.a)(n,2),u=a[0],s=a[1],d=I(e[s],"animateDuration")||o/(b.length+1);c.has(u)||(z(t,u,e[s],i,d,r),i+=d,c.set(u,!0))})),delete a[p]}else{var m=I(s,"animateDuration")||u;z(t,n,s,i,m,r),i+=m,c.set(n,!0)}})),{finishedMs:i+1e3}}(r,n,a);return console.log(r),e&&(a.startMs=c.finishedMs),{svg:r,finishedMs:c.finishedMs}}));return d(c),c}),[]);return Object(r.useEffect)((function(){Object(s.a)(u.a.mark((function t(){var e,n,r,c,i,o,s,d,p,b,h,m,v,g,w,x,j;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.location.hash.slice(1),n=new URLSearchParams(e),!(r=/([0-9]+),?([a-zA-Z0-9_-]*)/.exec(n.get("json")||""))){t.next=10;break}return c=Object(l.a)(r,3),i=c[1],o=c[2],t.next=7,_(i,o,null);case 7:s=t.sent,d=f([s]),p=Object(l.a)(d,1),b=p[0],h=b.svg,m=b.finishedMs,"no"===n.get("autoplay")&&h.setCurrentTime(m);case 10:if(!(v=/(.*\.excalidrawlib)/.exec(n.get("library")||""))){t.next=18;break}return g=Object(l.a)(v,2),w=g[1],t.next=15,$(w);case 15:x=t.sent,j=f(x.map((function(t){return{elements:t}})),n.has("sequence")),"no"===n.get("autoplay")&&j.forEach((function(t){var e=t.svg,n=t.finishedMs;e.setCurrentTime(n)}));case 18:a(!1);case 19:case"end":return t.stop()}}),t)})))()}),[f]),{loading:n,loadedSvgList:o,loadDataList:f}},K=/#json=([0-9]+),?([a-zA-Z0-9_-]*)|^http.*\.excalidrawlib$/,X=function(t){var e,n=(e=[]).concat.apply(e,Object(d.a)(t.map((function(t){return function(t){var e=[],n=[],r=function t(e){if("animate"===e.tagName){var r=/([0-9.]+)ms/.exec(e.getAttribute("begin")||"");r&&n.push(Number(r[1]))}e.childNodes.forEach((function(e){t(e)}))};return t.childNodes.forEach((function(t){"g"===t.tagName?(r(t),n.length&&(e.push(Math.min.apply(Math,n)),n.splice(0))):"defs"===t.tagName&&t.childNodes.forEach((function(t){r(t),n.length&&(e.push(Math.min.apply(Math,n)),n.splice(0))}))})),e}(t.svg).map((function(t){return Math.floor(100*t)/100}))}))));return Object(d.a)(new Set(n)).sort((function(t,e){return t-e}))},Y=function(t){var e=t.svgList,n=t.loadDataList,a=Object(r.useState)(!1),c=Object(l.a)(a,2),i=c[0],o=c[1],d=Object(r.useState)(!1),b=Object(l.a)(d,2),h=b[0],v=b[1],g=Object(r.useState)(!1),w=Object(l.a)(g,2),x=w[0],y=w[1],A=Object(r.useState)(""),C=Object(l.a)(A,2),N=C[0],k=C[1],E=Object(r.useState)(),M=Object(l.a)(E,2),L=M[0],T=M[1];Object(r.useEffect)((function(){T(void 0)}),[e]),Object(r.useEffect)((function(){e.forEach((function(t){var e=t.svg;h?e.pauseAnimations():e.unpauseAnimations()}))}),[e,h]),Object(r.useEffect)((function(){var t=window.location.hash.slice(1);"no"!==new URLSearchParams(t).get("toolbar")?o(!0):o("never")}),[]);var D=function(){var t=Object(s.a)(u.a.mark((function t(){var e;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j(null);case 2:e=t.sent,n([e]);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=Object(s.a)(u.a.mark((function t(){var e,r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.a)({description:"Excalidraw library files",extensions:[".json",".excalidrawlib"],mimeTypes:["application/json"]});case 2:return e=t.sent,t.next=5,m(e);case 5:if((r=t.sent)&&r.library){t.next=9;break}return window.alert("Unable to load library"),t.abrupt("return");case 9:a=r.library.map((function(t){return q(Object(p.restoreElements)(t))})),n(a.map((function(t){return{elements:t}})));case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=Object(r.useCallback)((function(){e.length&&v((function(t){return!t}))}),[e]),z=Object(r.useRef)(),F=Object(r.useCallback)((function(){if(e.length){var t=X(e),n=1e3*e[0].svg.getCurrentTime(),r=t.find((function(t){return t>=n+100}));r||(r=n+500),clearTimeout(z.current),e.forEach((function(t){t.svg.unpauseAnimations()})),z.current=setTimeout((function(){e.forEach((function(t){var e=t.svg;e.pauseAnimations(),e.setCurrentTime(r/1e3)})),v(!0)}),r-n)}}),[e]),B=Object(r.useCallback)((function(){e.forEach((function(t){t.svg.setCurrentTime(0)}))}),[e]);Object(r.useEffect)((function(){var t=function(t){"p"===t.key.toLowerCase()?P():"s"===t.key.toLowerCase()?F():"r"===t.key.toLowerCase()?B():"q"===t.key.toLowerCase()?o((function(t){return"boolean"===typeof t?!t:t})):o((function(t){return"boolean"===typeof t||t}))};return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}),[P,F,B]);var I=function(){var t=Object(s.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.length){t.next=2;break}return t.abrupt("return");case 2:if(!L){t.next=6;break}return t.next=5,U(L);case 5:return t.abrupt("return");case 6:return y(!0),o(!1),t.prev=8,t.next=11,W(e);case 11:n=t.sent,T(n),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(8),console.log(t.t0);case 18:o(!0),y(!1);case 20:case"end":return t.stop()}}),t,null,[[8,15]])})));return function(){return t.apply(this,arguments)}}();return!0!==i?null:Object(O.jsxs)("div",{className:"Toolbar",children:[Object(O.jsxs)("div",{className:"Toolbar-loader",children:[Object(O.jsx)("button",{type:"button",onClick:D,children:"Load File"}),Object(O.jsx)("span",{children:"OR"}),Object(O.jsx)("button",{type:"button",onClick:R,children:"Load Library"}),Object(O.jsx)("span",{children:"OR"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var e=K.exec(N);e?(e[1]?window.location.hash=e[0]:window.location.hash="library=".concat(e[0]),window.location.reload()):window.alert("Invalid link")},children:[Object(O.jsx)("input",{placeholder:"Enter link...",value:N,onChange:function(t){return k(t.target.value)}}),Object(O.jsx)("button",{type:"submit",disabled:!K.test(N),children:"Animate!"})]})]}),!!e.length&&Object(O.jsxs)("div",{className:"Toolbar-controller",children:[Object(O.jsx)("button",{type:"button",onClick:P,children:h?"Play (P)":"Pause (P)"}),Object(O.jsx)("button",{type:"button",onClick:F,children:"Step (S)"}),Object(O.jsx)("button",{type:"button",onClick:B,children:"Reset (R)"}),Object(O.jsx)("button",{type:"button",onClick:function(){o((function(t){return"boolean"!==typeof t&&t}))},children:"Hide Toolbar (Q)"}),Object(O.jsx)("button",{type:"button",onClick:function(){e.length&&e.forEach((function(t){var e=t.svg;G(e)}))},children:"Export to SVG"}),Object(O.jsx)("button",{type:"button",onClick:I,disabled:x,children:x?"Processing...":L?"Export to WebM":"Prepare WebM"})]}),Object(O.jsx)(S,{link:"https://github.com/dai-shi/excalidraw-animate",size:40})]})},tt=(n(48),function(t){var e=t.svgList,n=Object(r.useRef)(null);Object(r.useEffect)((function(){return e.forEach((function(t){var e=t.svg;n.current&&n.current.appendChild(e)})),function(){e.forEach((function(t){t.svg.remove()}))}}),[e]),Object(r.useEffect)((function(){var t=window.location.hash.slice(1);if("no"===new URLSearchParams(t).get("autoplay")&&n.current){var r=n.current,a=function(){e.forEach((function(t){var e=t.svg;e.setCurrentTime(0),e.unpauseAnimations()}))};return r.addEventListener("click",a),function(){r.removeEventListener("click",a)}}}),[e]);var a=Math.ceil(Math.sqrt(e.length)),c="repeat(".concat(a,", ").concat(100/a,"%)");return Object(O.jsx)("div",{className:"Viewer",style:{gridTemplateColumns:c,gridTemplateRows:c},ref:n})}),et=function(){var t=Q(),e=t.loading,n=t.loadedSvgList,r=t.loadDataList;return e?Object(O.jsx)("div",{children:"Loading..."}):Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(Y,{svgList:n,loadDataList:r}),!!n.length&&Object(O.jsx)(tt,{svgList:n})]})};i.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(et,{})}),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.2d05d39e.chunk.js.map